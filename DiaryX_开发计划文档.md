# DiaryX 开发计划文档

## 项目概述
DiaryX是一款注重隐私的离线优先日记应用，具备AI驱动的语音、文本和视觉内容捕获及智能组织功能。

**总预计时间：17-24周（4.5-6个月）**

---

## 第一阶段：架构搭建 (1-2周)

**注意：在运行任何 Flutter 依赖命令之前，请运行 `proxy` 命令进行本地机器设置。**

### 项目结构与架构
- [ ] 实现简单的类MVC文件夹结构（models、stores、pages、services、utils、widgets、themes、consts）
- [ ] 设置Provider + ChangeNotifier状态管理
- [ ] 创建核心服务的单例模式
- [ ] 设置基础路由配置
- [ ] 在main.dart中初始化MultiProvider设置

### 数据库基础
- [ ] 搭建Drift数据库和所有必需表结构
- [ ] 创建数据库服务单例
- [ ] 实现基础CRUD操作
- [ ] 设置数据库迁移系统

---

## 第二阶段：UI基础框架 (1-2周)

### 设计系统
- [ ] 实现设计系统（颜色、字体、间距）
- [ ] 创建主题管理（明暗模式）
- [ ] 设置themes文件夹结构（app_theme.dart、app_colors.dart、text_styles.dart）
- [ ] 在widgets文件夹中创建可复用UI组件

### 导航与核心UI
- [ ] 实现导航系统和路由
- [ ] 创建主应用结构和底部导航
- [ ] 设置基础屏幕模板
- [ ] 添加加载状态和错误处理UI

---

## 第三阶段：认证与基础录入 (2-3周)

### 身份认证
- [ ] 实现数字密码认证
- [ ] 设置密码安全存储
- [ ] 创建密码设置和验证界面
- [ ] 添加基础重试限制机制

### 文本录入系统
- [ ] 创建文本输入界面和编辑器
- [ ] 实现自动保存功能
- [ ] 添加条目创建和编辑
- [ ] 设置基础条目存储和检索
- [ ] 创建简单条目列表视图

---

## 第四阶段：多媒体支持 (2-3周)

### 音频录制
- [ ] 集成flutter_sound语音录制
- [ ] 实现录制UI和波形可视化
- [ ] 添加音频播放功能
- [ ] 设置音频文件存储和管理

### 相机集成
- [ ] 实现照片拍摄功能
- [ ] 添加视频录制（最长5分钟）
- [ ] 设置图片/视频压缩
- [ ] 创建媒体预览和选择UI
- [ ] 实现相册访问功能

---

## 第五阶段：内容组织 (2周)

### 时间线和日历视图
- [ ] 创建无限滚动时间线界面
- [ ] 实现日历月视图/周视图
- [ ] 添加内容类型指示器和缩略图
- [ ] 创建条目卡片和预览内容
- [ ] 添加下拉刷新功能

### 组织功能
- [ ] 实现手动标签系统
- [ ] 创建心情选择界面
- [ ] 添加过滤选项（日期、内容类型、心情）
- [ ] 实现排序功能
- [ ] 创建搜索栏（基础文本搜索）

---

## 第六阶段：AI集成 (3-4周)

### LLM服务设置
- [ ] 创建抽象LLM服务接口
- [ ] 实现Gemma 3n集成
- [ ] 设置Ollama API兼容性
- [ ] 创建模拟AI服务用于测试
- [ ] 添加本地vs远程AI配置

### 核心AI功能
- [ ] 实现语音转文字处理
- [ ] 添加文本增强和扩展
- [ ] 创建文本摘要功能
- [ ] 实现基础情绪分析
- [ ] 设置异步处理队列

### 处理管理
- [ ] 创建后台任务队列系统
- [ ] 实现基于优先级的处理
- [ ] 添加处理状态指示器
- [ ] 设置错误处理和重试逻辑
- [ ] 添加进度通知

---

## 第七阶段：智能搜索 (2-3周)

### 向量数据库
- [ ] 集成Chroma向量数据库
- [ ] 设置嵌入生成流水线
- [ ] 实现所有内容类型的向量存储
- [ ] 创建嵌入更新系统

### 语义搜索
- [ ] 实现向量相似性搜索
- [ ] 创建搜索结果排序算法
- [ ] 添加带过滤器的上下文搜索
- [ ] 实现搜索结果摘要
- [ ] 创建AI聊天界面用于对话搜索

---

## 第八阶段：分析洞察 (2周)

### 数据可视化
- [ ] 集成fl_chart数据可视化
- [ ] 创建心情趋势图表和热力图
- [ ] 实现写作频率统计
- [ ] 添加内容类型分布图表
- [ ] 创建情感词云

### 个人仪表板
- [ ] 构建分析仪表板界面
- [ ] 实现个人洞察显示
- [ ] 添加周/月总结
- [ ] 创建LLM分析界面
- [ ] 设置重复模式检测

---

## 第九阶段：优化完善 (2-3周)

### 性能优化
- [ ] 优化数据库查询和索引
- [ ] 实现高效图片/视频加载
- [ ] 为时间线添加懒加载
- [ ] 优化AI处理性能
- [ ] 实现适当的内存管理

### UI/UX增强
- [ ] 添加流畅动画和过渡效果
- [ ] 实现玻璃拟态效果
- [ ] 完善微交互
- [ ] 添加触觉反馈
- [ ] 创建加载状态和骨架屏

### 错误处理
- [ ] 实现全面错误处理
- [ ] 添加用户友好的错误消息
- [ ] 创建离线/在线状态管理
- [ ] 添加数据验证和清理
- [ ] 实现崩溃报告

---

## 第十阶段：测试发布 (1-2周)

### 质量保证
- [ ] 进行全面功能测试
- [ ] 测试边界情况和错误场景
- [ ] 执行性能和内存测试
- [ ] 在不同设备尺寸和操作系统版本上测试
- [ ] 验证AI处理准确性

### 发布准备
- [ ] 设置发布版本构建配置
- [ ] 创建应用图标和启动画面
- [ ] 准备应用商店元数据和截图
- [ ] 编写用户文档和帮助内容
- [ ] 创建引导教程界面

### 最终完善
- [ ] 修复任何剩余bug和问题
- [ ] 优化应用大小和启动时间
- [ ] 验证隐私和安全措施
- [ ] 准备应用商店提交
- [ ] 创建备份和数据导出功能

---

## 关键里程碑

- **第2周**：架构搭建和数据库基础完成
- **第4周**：UI基础框架和认证就绪
- **第7周**：文本录入和多媒体捕获正常工作
- **第9周**：内容组织和基础UI完成
- **第13周**：AI功能集成并正常运行
- **第16周**：智能搜索和分析功能实现
- **第19周**：应用完善并准备测试
- **第22周**：发布到应用商店

## 技术依赖

- Flutter 3.32.8 with Dart SDK
- Drift 本地数据库
- Chroma 向量存储
- Gemma 3n 本地AI处理
- 标准Flutter包：相机、音频、图表

## 成功标准

- [ ] 完全离线功能
- [ ] 流畅60fps性能
- [ ] AI处理时间少于30秒
- [ ] 直观的用户体验
- [ ] 稳定无崩溃运行
